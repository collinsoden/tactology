services:
  # -----------------------------------------------------------
  # BACKEND SERVICE (NestJS)
  # -----------------------------------------------------------
  - type: web
    name: departments-backend
    env: docker
    rootDir: backend
    dockerfilePath: Dockerfile
    numInstances: 1
    plan: starter
    autoDeploy: true
    envVars:
      PORT: 4000
      JWT_SECRET: super-secret-key
      DATABASE_URL:
        fromDatabase:
          name: departments-db
          property: connectionString
      FRONTEND_URL:
        value: https://departments-frontend.onrender.com
    healthCheckPath: /health

  # -----------------------------------------------------------
  # FRONTEND SERVICE (Next.js)
  # -----------------------------------------------------------
  - type: web
    name: departments-frontend
    env: docker
    rootDir: frontend
    dockerfilePath: Dockerfile
    numInstances: 1
    plan: starter
    autoDeploy: true
    envVars:
      NEXT_PUBLIC_API_URL:
        value: https://departments-backend.onrender.com

databases:
  # -----------------------------------------------------------
  # MANAGED POSTGRES DATABASE
  # -----------------------------------------------------------
  - name: dbname
    plan: free
